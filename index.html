<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TV M3U Lite - Local</title>
<style>
  /* Mesma parte de CSS do c√≥digo anterior, adaptada para simplicidade */
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
    font-size: 14px;
    line-height: 1.3;
    padding: 10px;
  }
  .item-card {
    background: #333;
    border-radius: 6px;
    width: 180px;
    margin: 8px;
    display: inline-block;
    vertical-align: top;
    color: #eee;
  }
  .item-card img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    background: #444;
  }
  .item-name {
    padding: 6px;
    font-size: 14px;
  }
  .download-btn {
    background: #1db954;
    border: none;
    border-radius: 4px;
    padding: 6px 8px;
    color: white;
    cursor: pointer;
    margin: 6px;
    width: calc(100% - 12px);
  }
</style>
</head>
<body>

<h2>TV M3U Lite - Local</h2>
<input type="file" id="fileInput" accept=".m3u,.m3u8" />
<div id="itemsContainer"></div>

<script>
  var allItems = [];

  document.getElementById('fileInput').addEventListener('change', function(e) {
    if (e.target.files.length === 0) return;
    var file = e.target.files[0];
    var reader = new FileReader();

    reader.onload = function(evt) {
      parseM3U(evt.target.result);
    };
    reader.readAsText(file);
  });

  function parseM3U(text) {
    allItems = [];
    var lines = text.split('\n');
    var currentItem = null;
    var container = document.getElementById('itemsContainer');
    container.innerHTML = '';

    for (var i = 0; i < lines.length; i++) {
      var line = lines[i].trim();

      if (line.startsWith('#EXTINF:')) {
        currentItem = parseExtInf(line);
      } else if (currentItem && line && !line.startsWith('#') && line.startsWith('http')) {
        currentItem.url = line;
        allItems.push(currentItem);
        currentItem = null;
      }
    }
    renderItems();
  }

  function parseExtInf(line) {
    var item = { nome: '', url: '', capa: '' };
    var logoStart = line.indexOf('tvg-logo="');
    if (logoStart > -1) {
      var logoEnd = line.indexOf('"', logoStart + 9);
      if (logoEnd > -1) {
        item.capa = line.substring(logoStart + 9, logoEnd);
      }
    }
    var lastComma = line.lastIndexOf(',');
    if (lastComma > -1) {
      item.nome = line.substring(lastComma + 1).trim();
    }
    return item;
  }

  function renderItems() {
    var container = document.getElementById('itemsContainer');
    container.innerHTML = '';
    allItems.forEach(item => {
      var div = document.createElement('div');
      div.className = 'item-card';

      var img = document.createElement('img');
      img.src = item.capa || 'https://via.placeholder.com/180x100?text=No+Image';
      img.alt = item.nome;

      var nome = document.createElement('div');
      nome.className = 'item-name';
      nome.textContent = item.nome;

      var btn = document.createElement('button');
      btn.className = 'download-btn';
      btn.textContent = 'Download';
      btn.onclick = () => baixarItem(item.url, item.nome);

      div.appendChild(img);
      div.appendChild(nome);
      div.appendChild(btn);

      container.appendChild(div);
    });
  }

  function baixarItem(url, nome) {
    var a = document.createElement('a');
    a.href = url;
    a.download = nome || 'arquivo';
    a.target = '_blank';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }
</script>
</body>
</html>
